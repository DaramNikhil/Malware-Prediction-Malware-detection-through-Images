import streamlit as st
import tensorflow as tf
import numpy as np
from PIL import Image

model = tf.keras.models.load_model("model/malware_detection_cnn_model.h5")

st.title("Malware Detection Model")
st.write("Upload an image to check if it is malware or benign.")
file = st.file_uploader("Choose an image...", type=["jpg", "png", "jpeg"])

if file is not None:
    try:
        img = Image.open(file).resize((128, 128))
        img = img.convert("RGB")
        img_array = np.expand_dims(np.array(img) / 255.0, axis=0)
        prediction = model.predict(img_array)[0][0] 
        result = "Malware" if prediction > 0.5 else "Benign"
        st.image(img, caption='Uploaded Image', use_container_width=True)
        st.write(f"Prediction: {result}")
        st.write(f"Confidence: {prediction:.2f}")
    except Exception as e:
        st.error(f"Error: {str(e)}")
